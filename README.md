# 🐱 ComfyUI-CATS-tools - Creative Assistant Tools Suite

一个用于ComfyUI的创意助手工具套件，集成了三个实用的节点，帮助您更高效地管理提示词和图像序列。

## 功能介绍

### 1. 🔤 字符串保存节点

用于接收任何类型的字符串输入，在节点下方实时展示内容，并将其保存到指定路径的文本文件中。

#### 功能特点
- 支持多行文本输入和连接其他节点的字符串输出
- 实时在节点下方展示处理后的内容
- 支持两种保存模式：
  - **single_file**：每次执行保存为新文件，自动添加累计数字后缀
  - **wildcards_format**：汇总保存到同一文件，每行一组提示词
- 自动创建不存在的保存路径
- 支持多种输入类型，会自动尝试提取有意义的内容
- 无论输入文件名是什么扩展名，最终都保存为.txt文件

#### 输入参数
- **文本**：要保存的字符串或连接其他节点的输出
- **save_path**：保存文件的目标路径
- **file_name**：保存的文件名（无需.txt扩展名，会自动添加）
- **save_mode**：保存模式（single_file/wildcards_format）

### 2. 🎲 随机抽取提示词

从wildcards格式的文本文件中随机抽取指定数量的提示词，并可选择添加固定前缀。

#### 功能特点
- 支持从本地wildcards文件中随机抽取提示词
- 可设置抽取数量（1-100个）
- 支持随机种子设置，便于复现结果
- 可添加固定提示词前缀
- 支持多行输出，每个抽取的提示词单独一行
- 完善的错误处理和提示

#### 输入参数
- **wildcard_file**：wildcards文件路径（.txt格式）
- **num_prompts**：要抽取的提示词数量（1-100）
- **seed**：随机种子（0表示随机，非0表示固定种子）
- **fixed_prompt**：固定提示词前缀（可选）

### 3. 🖼️ 图像序列加载器

加载文件夹下的所有图片，在搭配计数节点的情况下实现每运行一次自动切换下一张图片。

#### 功能特点
- 支持加载文件夹下所有常见格式的图片（png, jpg, jpeg, webp）
- 自动按文件修改时间排序
- 每次执行自动切换到下一张图片
- 输出当前加载的图片文件名
- 路径标准化处理，确保跨平台兼容性
- 支持文件夹路径变化时自动重新加载

#### 输入参数
- **folder_path**：包含图片的文件夹路径
- **trigger**：触发信号（通常连接计数节点）
- **filename_display**：文件名显示（可选，用于UI显示）

#### 输出参数
- **IMAGE_OUT**：加载的图片张量
- **FILENAME**：当前加载的图片文件名

## 安装方法

### 方法1：通过ComfyUI管理器安装
1. 打开ComfyUI管理器
2. 搜索"🐱 CATS"或"ComfyUI-CATS-tools"
3. 点击安装

### 方法2：手动安装
1. 下载本插件的压缩包
2. 解压到ComfyUI的`custom_nodes`目录下，并重命名为`ComfyUI-CATS-tools`
3. 重启ComfyUI

### 方法3：Git克隆
```bash
git clone https://github.com/LULUyu-333/ComfyUI-Wildcards-Generator.git custom_nodes/ComfyUI-CATS-tools
```

## 目录结构

```
ComfyUI-CATS-tools/
├── web/
│   └── image_sequence_widget.js  # 图像序列加载器的Web界面组件
├── __init__.py                   # 插件初始化和节点注册
├── nodes.py                      # 所有节点的实现
└── README.md                     # 插件说明文档
```

## 使用示例

### 示例1：保存反推提示词
1. 连接图像反推节点的输出到"字符串保存节点"
2. 设置保存路径为您想要保存的目录
3. 选择保存模式为`wildcards_format`
4. 将图像文件名连接到file_name参数
5. 执行后，反推的提示词将被保存为与图片同名的.txt文件

### 示例2：随机生成提示词
1. 准备一个包含多种风格提示词的wildcards文件
2. 使用"随机抽取提示词"节点加载该文件
3. 设置抽取数量为5
4. 添加固定前缀"high quality, masterpiece, "
5. 执行后，将生成5个带有固定前缀的随机风格提示词
6. 连接到图像生成节点，生成不同风格的图像

### 示例3：图像序列处理
1. 使用"图像序列加载器"节点加载包含多张图片的文件夹
2. 连接计数节点到trigger参数
3. 将加载的图片连接到图像处理节点
4. 将输出文件名连接到"字符串保存节点"
5. 每次执行，将自动处理下一张图片并保存相关信息

## 注意事项

1. 确保保存路径有写入权限
2. wildcards文件应为纯文本文件，每行一个提示词
3. 随机种子为0时每次执行结果不同，设置固定种子可复现结果
4. 字符串保存节点会自动将任何输入文件名转换为.txt格式
5. 图像序列加载器会按文件修改时间排序，确保序列的正确性
6. 所有节点都可以在ComfyUI中通过搜索"CATS"找到

## 常见问题

### Q: 为什么我的文件没有保存？
A: 请检查保存路径是否正确，以及是否有写入权限。确保输入的文本不为空。

### Q: 为什么随机抽取的提示词每次都一样？
A: 请检查随机种子是否设置为0。如果设置了固定种子，每次执行结果都会相同。

### Q: 图像序列加载器为什么没有显示所有图片？
A: 请确保文件夹中只包含支持的图片格式（png, jpg, jpeg, webp），并且文件没有损坏。

### Q: 为什么我搜索不到这些节点？
A: 请确保插件已正确安装，并在ComfyUI中搜索"CATS"（大写）。

## 版本历史

### v2.0.0
- 整合为CATS插件套件
- 重命名节点分类为"CATS"
- 改进字符串保存节点的文件名处理
- 添加图像序列加载器节点
- 更新README.md文档

### v1.0.0
- 初始版本
- 实现字符串保存节点
- 实现随机抽取提示词节点

## 许可证

MIT License

## 作者

Seven cats
